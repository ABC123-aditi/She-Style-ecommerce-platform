<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ShopEase | Products</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;600&display=swap" rel="stylesheet">

<style>
body {
  margin: 0;
  font-family: 'Poppins', sans-serif;
  background: #ffe6f0;
}

/* ================= NAVBAR ================= */
nav {
  padding: 18px 60px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: white;
}

.logo {
  font-size: 26px;
  font-weight: 700;
  color: #ff4da6;
}

nav a {
  text-decoration: none;
  margin-left: 30px;
  color: #444;
  font-weight: 700;
}

nav a:hover {
  color: #ff4da6;
}

#cart-count {
  background: red;
  color: rgb(18, 17, 17);
  font-size: 12px;
  padding: 2px 6px;
  border-radius: 50%;
  position: absolute;
  top: -8px;
  right: -12px;
}

/* ================= PRODUCTS ================= */
h2 {
  text-align: center;
  margin-top: 30px;
}

.products {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 20px;
  max-width: 1200px;
  margin: 30px auto;
  padding: 0 20px;
}

.product-card {
  background: #fff;
  padding: 15px;
  border-radius: 10px;
  text-align: center;
}

.product-card img {
  width: 100%;
  height: 180px;
  object-fit: cover;
  border-radius: 8px;
}

.product-card p {
  font-size: 16px;
  color: #e91e63;
  font-weight: bold;
}

button {
  background: #333;
  color: #fff;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
}

button:disabled {
  background: #aaa;
  cursor: not-allowed;
}
</style>
</head>

<body>

<!-- NAVBAR -->
 <nav>
  <div class="logo">She Style</div>
  <div class="nav-links">
    <a href="home.html">Home</a>
    <a href="product.html">Product</a>
    <a href="about.html">About</a>
    <a href="contact.html">Contact</a>
    <a href="cart.html">Cart ðŸ›’
    <span id="cart-count">0</span> </a>
  </div>
</nav>



<h2>Featured Products</h2>

<div class="products" id="products"></div>

<script>
let productsData = [];

/* ================= LOAD PRODUCTS ================= */
async function loadProducts() {
  try {
    const res = await fetch("http://localhost:5000/api/products");
    productsData = await res.json();

    const container = document.getElementById("products");
    container.innerHTML = "";

    productsData.forEach(p => {
      container.innerHTML += `
        <div class="product-card">
          <img src="http://localhost:5000/images/${p.image}"
               onerror="this.src='https://via.placeholder.com/250x180?text=No+Image'">
          <h3>${p.name}</h3>
          <p>â‚¹${p.price}</p>
          <p>Stock: ${p.stock}</p>
          <button onclick="addToCart('${p._id}')" ${p.stock === 0 ? "disabled" : ""}>
            ${p.stock === 0 ? "Out of Stock" : "Add to Cart"}
          </button>
        </div>
      `;
    });

  } catch (err) {
    document.getElementById("products").innerHTML =
      "<p style='color:red;text-align:center'>Error loading products</p>";
  }
}

/* ================= ADD TO CART ================= */
function addToCart(productId) {
  let cart = JSON.parse(localStorage.getItem("cart")) || [];

  const product = productsData.find(p => p._id === productId);
  if (!product) return;

  const existing = cart.find(i => i._id === productId);

  if (existing) {
    if (existing.quantity < product.stock) {
      existing.quantity++;
    } else {
      alert("âŒ Stock limit reached");
      return;
    }
  } else {
    cart.push({
      _id: product._id,
      name: product.name,
      price: product.price,
      image: product.image,
      stock: product.stock,
      quantity: 1
    });
  }

  localStorage.setItem("cart", JSON.stringify(cart));
  updateCartCount();
  alert("âœ… Product added to cart");
}

/* ================= CART COUNT ================= */
function updateCartCount() {
  const cart = JSON.parse(localStorage.getItem("cart")) || [];
  const count = cart.reduce((sum, item) => sum + item.quantity, 0);
  document.getElementById("cart-count").innerText = count;
}

/* INIT */
loadProducts();
updateCartCount();
</script>

</body>
</html>
